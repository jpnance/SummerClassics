extends layout.pug

block title
	+title('Big Board')

block content
	div.row
		div.col-12.pb-3
			ul.nav.justify-content-center
				if dateFormat(yesterday, 'yyyy-mm-dd') >= '2018-03-29'
					li.nav-item
						a.nav-link(href='/schedule/' + dateFormat(yesterday, 'yyyy-mm-dd'))
							span.d-none.d-sm-inline #{dateFormat(yesterday, 'mmmm dS')}
							span.d-sm-none #{dateFormat(yesterday, 'm/d')}
				li.nav-item
					a.nav-link.disabled(href='/schedule/' + dateFormat(today, 'yyyy-mm-dd'))
						span.d-none.d-sm-inline #{dateFormat(today, 'mmmm dS')}
						span.d-sm-none #{dateFormat(today, 'm/d')}
				if dateFormat(tomorrow, 'yyyy-mm-dd') <= '2018-09-30'
					li.nav-item
						a.nav-link(href='/schedule/' + dateFormat(tomorrow, 'yyyy-mm-dd'))
							span.d-none.d-sm-inline #{dateFormat(tomorrow, 'mmmm dS')}
							span.d-sm-none #{dateFormat(tomorrow, 'm/d')}

		if session && session.user.admin
			each game in games
				div.col-xs-12.col-sm-6.col-md-6.col-lg-4.mb-4(id='game-' + game._id)
					div.card
						div.card-header.py-1(class=game.isActuallyHappening() && !game.isFinal() ? 'bg-primary' : '')
							div.row.justify-content-center
								div.col-10.col-sm-12.col-md-12.text-center
									a(href='https://www.mlb.com/gameday/' + game._id class=game.isActuallyHappening() && !game.isFinal() ? 'text-white' : '')
										if game.isDelayed()
											| Delayed
										else if !game.hasStarted()
											| #{dateFormat(game.startTime, 'h:MMtt')} ET
										else if game.isOver()
											| Final
											if game.inning.number != 9
												|
												| (#{game.inning.number})
										else if game.isActuallyHappening()
											| #{game.inning.state} of the #{game.inning.ordinal}
										else
											| Live

						ul.list-group.list-group-flush
							li.list-group-item.py-1(class=game.away.winner ? '' : '')
								div.row.justify-content-center
									div.col-6.col-sm-8.col-md-8
											h5.mb-0.text-nowrap
												a.font-weight-bold(href='/schedule/' + game.away.team.abbreviation) #{game.away.team.teamName}
											div.pitcher.mb-0.text-nowrap
												+pitcher(game.away.probablePitcher)
									h2.col-4.col-sm-4.col-md-4.text-center.font-weight-normal.mb-0
										if game.isActuallyHappening()
											| #{game.away.score}
								div.row
									if game.isActuallyHappening()
										div.picks.col-8.offset-1.pt-2.pb-1
											| Patrick, David S., Kevin
											//| , Brett, Luke, Anthony, Adam
							li.list-group-item.py-1(class=game.home.winner ? '' : '')
								div.row.justify-content-center
									div.col-6.col-sm-8.col-md-8
											h5.mb-0.text-nowrap
												a.font-weight-bold(href='/schedule/' + game.home.team.abbreviation) #{game.home.team.teamName}
											div.pitcher.mb-0.text-nowrap
												+pitcher(game.home.probablePitcher)
									h2.col-4.col-sm-4.col-md-4.text-center.font-weight-normal.mb-0
										if game.isActuallyHappening()
											| #{game.home.score}

						if !game.isActuallyHappening()
							div.card-footer.text-center
								div.btn-group
									div.team.btn-group.pb-2(id='team-' + game.away.team._id class=game.away.picked ? 'picked': 'unpicked')
										+teamButtons(session, game, game.away.team)
									div.team.btn-group.pb-2(id='team-' + game.home.team._id class=game.home.picked ? 'picked': 'unpicked')
										+teamButtons(session, game, game.home.team)
						else if game.away.picks.length > 0 || game.home.picks.length > 0
							div.card-footer
								div.picks.row.justify-content-center
									div.col-2.col-sm-3.col-md-2.pr-0 #{game.away.team.abbreviation}
									-
										var picksClass = 'text-muted';

										if (game.isFinal()) {
											if (game.away.score > game.home.score) {
												picksClass = 'text-success';
											}
											else if (game.home.score > game.away.score) {
												picksClass = 'text-danger';
											}
										}

									div.col-8.col-sm-9.col-md-10(class=picksClass)
										if game.away.picks
											span.align-text-bottom
												each pick in game.away.picks
													| #{pick.displayName}
													if pick != game.away.picks[game.away.picks.length - 1]
														| ,
														|
												| Patrick, Schex, Kevin
								div.picks.row.justify-content-center
									div.col-2.col-sm-3.col-md-2.pr-0 #{game.home.team.abbreviation}
									-
										var picksClass = 'text-muted';

										if (game.isFinal()) {
											if (game.home.score > game.home.score) {
												picksClass = 'text-success';
											}
											else if (game.home.score > game.home.score) {
												picksClass = 'text-danger';
											}
										}

									div.col-8.col-sm-9.col-md-10(class=picksClass)
										if game.home.picks
											each pick in game.home.picks
												| #{pick.displayName}
												if pick != game.home.picks[game.home.picks.length - 1]
													| ,
													|

		each game in games
			div.col-xs-12.col-sm-6.col-md-4.col-lg-3.mb-4(id='game-' + game._id)
				h6.game-status
					a(href='https://www.mlb.com/gameday/' + game._id)
						if game.isDelayed()
							| Delayed
						else if !game.hasStarted()
							| #{dateFormat(game.startTime, 'h:MMtt')} ET
						else if game.isOver()
							| Final
							if game.inning.number != 9
								|
								| (#{game.inning.number})
						else if game.isActuallyHappening()
							| #{game.inning.state} of the #{game.inning.ordinal}
						else
							| Live

				if game.hasStarted()
					div.live-game
						-
							var picksClass = 'text-muted';

							if (game.isFinal()) {
								if (game.away.score > game.home.score) {
									picksClass = 'text-success';
								}
								else if (game.home.score > game.away.score) {
									picksClass = 'text-danger';
								}
							}

						div.row
							h5.col-4.col-sm-6.col-md-9.mb-0.text-nowrap #{game.away.team.teamName}
							h5.col-2.col-sm-3.col-md-3.text-right.mb-0 #{game.away.score}
						div.row.mb-1
							div.picks.col-6.col-sm-9.col-md-12(class=picksClass)
								if game.away.picks
									each pick in game.away.picks
										| #{pick.displayName}
										if pick != game.away.picks[game.away.picks.length - 1]
											| ,
											|

						-
							var picksClass = 'text-muted';

							if (game.isFinal()) {
								if (game.home.score > game.away.score) {
									picksClass = 'text-success';
								}
								else if (game.away.score > game.home.score) {
									picksClass = 'text-danger';
								}
							}

						div.row
							h5.col-4.col-sm-6.col-md-9.mb-0.text-nowrap #{game.home.team.teamName}
							h5.col-2.col-sm-3.col-md-3.text-right.mb-0 #{game.home.score}
						div.row
							div.picks.col-6.col-sm-9.col-md-12(class=picksClass)
								if game.home.picks
									each pick in game.home.picks
										| #{pick.displayName}
										if pick != game.home.picks[game.home.picks.length - 1]
											| ,
											|

				else if !game.hasStarted()
					div.team.pb-2(id='team-' + game.away.team._id class=game.away.picked ? 'picked': 'unpicked')
						+teamButtons(session, game, game.away.team, game.away.probablePitcher)
					div.team.pb-2(id='team-' + game.home.team._id class=game.home.picked ? 'picked': 'unpicked')
						+teamButtons(session, game, game.home.team, game.home.probablePitcher)
